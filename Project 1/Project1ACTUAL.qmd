---
title: "Project1ACTUAL"
format: html
editor: visual
---

#Step #2 Data Notebook

```{r}
#A - Load libraries

library(tidyverse)
library(rio)
library(janitor)

```

```{r}
#B - Import the data

ED1a <- rio::import("EDDIE January FINAL.xlsx", sheet="ED1a")

ED1a <- clean_names(ED1a)

```

```{r}
#C -  Background infromation

#In June, the Maryland Hospitals Association established EDDIE, the Emergency Department Dramatic Improvements Effort, to address hospital wait times in the state. By having each hospital set objectives for lowering emergency department wait times and discharges, EDDIE aims to put Maryland hospitals back on target with the rest of the country. Now, the state has one of the highest average wait times in the country. EDDIE has been collecting monthly data on each Maryland hospitalâ€™s average wait times, and I have that data from July through January, provided by a request to the Maryland Hospital Association.

#The data provided by the MHA is fairly large and consists of numerous variables.
#In the file, the following sheets are available: EDDIE All Data, ED1a, ED1b, ED1c, OP18a, OP18b, OP18c, ED1a Volume, ED1b Volume, ED1c Volume, OP18a Volume, OP18b Volume, OP18c Volune
#The Volume sheets refer to the volume of visiors to the hospital.
#ED1 refers to emergency department "arrival to inpatient admission time" and OP refers outpatients who are discharged into the community for "outpatient ED arrival to discharge time" according to Damiara Smith, a quality fellow for the MHA cost review commission.
#ED1b/OP18b refer to non-psych patients, while ED1c/OP18c refer to psychiatric patients.
#ED1a/OP18a refer to all patients.

#For this project, I have chosen to analyze the ED1a columns to measure hospital patient arrival to emergency department admission on a general basis for all patients, as opposed to psych or non-psych.
```

```{r}
#D - Add research questions here

#1. What hospitals in Maryland are seeing the most and least improvement?
  #1a. Which 5 hospitals had the lowest percent change since base month?
  #1b. How many hospitals have had increasing wait times from their base month to January? Which 5 have had the biggest increases? 
#2. What does each hospital's month over month look like?
#3. Are there any patterns between urban and rural hospitals? What factors affect wait times in each of these areas? (Doing at a later date)

```

What hospitals in Maryland are seeing the most and least improvement?

Which 5 hospitals had the lowest percent change since base month?

\*Using August for all for now

Note: I am caluclating this by base month, or the first month MHA had data for that hospital. Some have data since July, but some only have data since August.

```{r}
Pct_change <- ED1a %>% 
  select(abbreviated_name, june_median, august_median, january_median, change_from_base_month_to_latest_improvement) %>% 
  arrange(change_from_base_month_to_latest_improvement)

Pct_change <- Pct_change %>%
  select(abbreviated_name, june_median, august_median, january_median, change_from_base_month_to_latest_improvement) %>% 
    mutate(base_june = (january_median - june_median)/june_median *100,
           base_august= (january_median - august_median)/august_median *100) 

#Note for future to set condition to use August only if there isn't a June

Pct_change_top5 <- Pct_change %>% 
  arrange(base_august) %>% 
  head(5)

print(Pct_change_top5)
#Answer: White Oak (at -427.8%), UMMC Midtwon (at -15.4), Mercy (at -14.4%,), Atlantic General (at -12.7%) and Shady Grove (at -10.5%) had the lowest percent change, and thus the biggest decreases in hospital wait times since their base month.
```

How many hospitals have had increasing wait times from their base month to January? Which 5 have had the biggest increases?

```{r}
Pct_change2 <- ED1a %>% 
  select(abbreviated_name, june_median, august_median, january_median, change_from_base_month_to_latest_improvement) %>% 
  arrange(desc(change_from_base_month_to_latest_improvement))

#Answer: 33 hospitals have increasing waittimes since their base month.

Pct_change2 <- ED1a %>% 
  select(abbreviated_name, june_median, august_median, january_median, change_from_base_month_to_latest_improvement) %>% 
   mutate(base_june = (january_median - june_median)/june_median *100,
           base_august= (january_median - august_median)/august_median *100) %>% 
  arrange(desc(base_august)) %>% 
  head(5)

print(Pct_change2)
  
#Answer: Of the 33 hospitals, the five with the highest increasing wait times were Upper Chesapeake (at 136.6%), MedStar Good Samaritan (at 84.9%), Carroll (at 76.3%), Union ChristianaCare (at 62.6%) and Holy Cross Germantown (at 60.5%).

```

What is the state's month over month? As of January, what is month over month for hospital with the lowest and shortest wait time?

```{r}
#Statewide

#They only gave me statewide median but not per month, so I will need to request that. Currentl, the statewide meadian is 526 minutes, which is up 125 minutes since June.
```

```{r}
#Hospital with longest wait time in January

longest <- ED1a %>% 
  select(abbreviated_name, january_median) %>% 
  arrange(desc(january_median))


#In January, University of Maryland Shore Eastern had the longest wait time at 1770.5 minutes


longest_graph <- rio::import("EDDIE January FINAL.xlsx", sheet="UMES")

longest_graph <- clean_names(longest_graph)

longest_graph %>% 
  ggplot(aes(x=month, y=median, weight=median, fill=month)) +
  geom_col()+
  geom_text(aes(label=median), vjust = -1, size = 2.5) +
  labs(
    title="Median Time (in minutes) by Month for UM Shore Eastern",
    x = "month",
    y = "median",
    caption = "source: Maryland Hospital Association Cost Review Commisssion")

#Note to Professor Wells- I know that I shouldn't have made a new sheet "UMES" to upload. I originally filtered "longest" for when january == 1770.5 in order to only have that row. Then I did t() to flip it and have the data in an (x,y) table format to make into a graph. But the issue was that my y column didn't have a label so I couldn't code y in ggplot at a blank. So I went into excel and made an x,y table from the data and then uploaded it. If you can help me correct this, that would be great. I still figured out how to get the answer, but I know that there is probably a better way.
```

```{r}
#Hospital with shortest wait time in January

shortest <- ED1a %>% 
  select(abbreviated_name, january_median) %>% 
  arrange(january_median)

print(shortest)

#In January, Atlantic General had the longest wait time at 193 minutes

shortest_graph <- rio::import("EDDIE January FINAL.xlsx", sheet="AG")

shortest_graph <- clean_names(shortest_graph)

shortest_graph %>% 
  ggplot(aes(x=month, y=median, weight=median, fill=month)) +
  geom_col()+
  geom_text(aes(label=median), vjust = -1, size = 2.5) +
  labs(
    title="Median Time (in minutes) by Month for Atlantic General",
    x = "month",
    y = "median",
    caption = "source: Maryland Hospital Association Cost Review Commisssion")

```
```{r}
#Findings from charts:
#Atlantic General had a significantly smaller average wait time (although an about 200 minute wait time at an emergency department is still long) than UM Eastern Shore. The variation in Eastern Shore's times was also a signifciantly larger range. I was shocked to see that from November to January, UM Eastern Shore's wait time increased by almost 1000 minutes on average.

#From this data, I would want to talk to someone at each hospital to ask what was going on. I'd also be interested in talking to people who visited UM Eastern Shore and waited 1700 minutes (over 28 hours) to be seen in an emergency room.

#I also want to look into UM Eastern Shores' outlined objectives and goals for decreasing times that are required to be stated under the new EDDIE program. How does the hospital's objectives relate to the reality of its extremely flunctuating wait times for patients.

```